<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Enterprise Modular Test Runner</title>
    
    <!-- Test runner CSS -->
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 10px; margin-bottom: 20px; }
        .header h1 { margin: 0; font-size: 2.5em; }
        .header p { margin: 10px 0 0 0; opacity: 0.9; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center; }
        .stat-number { font-size: 2em; font-weight: bold; margin-bottom: 5px; }
        .stat-label { color: #666; font-size: 0.9em; }
        .stat-pass { color: #4CAF50; }
        .stat-fail { color: #f44336; }
        .stat-total { color: #2196F3; }
        .stat-files { color: #FF9800; }
        
        .file-list { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .file-list h3 { margin-top: 0; color: #333; }
        .file-item { margin: 8px 0; padding: 8px 12px; border-radius: 4px; display: flex; align-items: center; }
        .file-item.loaded { background: #e8f5e8; color: #2e7d32; }
        .file-item.error { background: #ffebee; color: #c62828; }
        .file-item.loading { background: #fff3e0; color: #ef6c00; }
        .file-icon { margin-right: 8px; font-weight: bold; }
        
        .test-results { background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); overflow: hidden; }
        .test-suite { border-bottom: 1px solid #eee; }
        .test-suite:last-child { border-bottom: none; }
        .test-suite-header { background: #f8f9fa; padding: 15px 20px; border-bottom: 1px solid #eee; }
        .test-suite-header h2 { margin: 0; color: #333; font-size: 1.3em; }
        .test-suite-body { padding: 0; }
        
        .test-case { padding: 12px 20px; border-bottom: 1px solid #f0f0f0; display: flex; align-items: center; }
        .test-case:last-child { border-bottom: none; }
        .test-case.pass { background: #f1f8e9; border-left: 4px solid #4CAF50; }
        .test-case.fail { background: #ffebee; border-left: 4px solid #f44336; }
        .test-icon { margin-right: 12px; font-size: 1.2em; font-weight: bold; }
        .test-name { flex: 1; }
        .test-error { margin-top: 8px; font-size: 0.9em; color: #666; font-family: monospace; background: #f5f5f5; padding: 8px; border-radius: 4px; }
        
        .loading { text-align: center; padding: 40px; color: #666; }
        .loading-spinner { display: inline-block; width: 20px; height: 20px; border: 3px solid #f3f3f3; border-top: 3px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¢ Enterprise Test Runner</h1>
            <p>Modular offline testing for large-scale applications</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number stat-pass" id="stat-passed">0</div>
                <div class="stat-label">Passed</div>
            </div>
            <div class="stat-card">
                <div class="stat-number stat-fail" id="stat-failed">0</div>
                <div class="stat-label">Failed</div>
            </div>
            <div class="stat-card">
                <div class="stat-number stat-total" id="stat-total">0</div>
                <div class="stat-label">Total Tests</div>
            </div>
            <div class="stat-card">
                <div class="stat-number stat-files" id="stat-files">0</div>
                <div class="stat-label">Test Files</div>
            </div>
        </div>

        <div class="file-list">
            <h3>üìÅ Test Files Status</h3>
            <div id="file-status">
                <div class="loading">
                    <span class="loading-spinner"></span>
                    Loading test configuration...
                </div>
            </div>
        </div>

        <div class="test-results" id="test-results">
            <div class="loading">
                <span class="loading-spinner"></span>
                Preparing to run tests...
            </div>
        </div>
    </div>

    <!-- Load test configuration -->
    <script src="test-config.js"></script>

    <script>
        // Minimal jQuery implementation
        window.$ = function(selector) {
            if (typeof selector === 'string') {
                return {
                    text: function(value) {
                        if (value !== undefined) {
                            const elements = document.querySelectorAll(selector);
                            elements.forEach(el => el.textContent = value);
                            return this;
                        } else {
                            const element = document.querySelector(selector);
                            return element ? element.textContent : '';
                        }
                    },
                    show: function() {
                        const elements = document.querySelectorAll(selector);
                        elements.forEach(el => el.style.display = 'block');
                        return this;
                    },
                    hide: function() {
                        const elements = document.querySelectorAll(selector);
                        elements.forEach(el => el.style.display = 'none');
                        return this;
                    },
                    is: function(state) {
                        if (state === ':visible') {
                            const element = document.querySelector(selector);
                            return element && element.style.display !== 'none';
                        }
                        return false;
                    },
                    length: document.querySelectorAll(selector).length,
                    val: function(value) {
                        if (value !== undefined) {
                            const elements = document.querySelectorAll(selector);
                            elements.forEach(el => el.value = value);
                            return this;
                        } else {
                            const element = document.querySelector(selector);
                            return element ? element.value : '';
                        }
                    }
                };
            }
            return {};
        };
        $.fn = { jquery: '3.7.1' };

        // Test Framework
        let testSuites = [];
        let currentSuite = null;
        let totalTests = 0;
        let passedTests = 0;
        let failedTests = 0;
        let loadedFiles = [];

        function describe(suiteName, suiteFunction) {
            currentSuite = { name: suiteName, tests: [] };
            testSuites.push(currentSuite);
            suiteFunction();
        }

        function test(testName, testFunction) {
            if (!currentSuite) return;
            
            try {
                testFunction();
                currentSuite.tests.push({ name: testName, status: 'pass', error: null });
                passedTests++;
            } catch (error) {
                currentSuite.tests.push({ name: testName, status: 'fail', error: error.message });
                failedTests++;
                
                if (TEST_CONFIG.settings.stopOnFirstFailure) {
                    throw error;
                }
            }
            totalTests++;
        }

        function expect(actual) {
            return {
                toBe: function(expected) {
                    if (actual !== expected) {
                        throw new Error(`Expected: ${expected}, Received: ${actual}`);
                    }
                },
                toEqual: function(expected) {
                    if (JSON.stringify(actual) !== JSON.stringify(expected)) {
                        throw new Error(`Expected: ${JSON.stringify(expected)}, Received: ${JSON.stringify(actual)}`);
                    }
                },
                toContain: function(expected) {
                    if (!actual.includes(expected)) {
                        throw new Error(`Expected "${actual}" to contain "${expected}"`);
                    }
                },
                toBeGreaterThan: function(expected) {
                    if (actual <= expected) {
                        throw new Error(`Expected ${actual} to be greater than ${expected}`);
                    }
                },
                toBeTruthy: function() {
                    if (!actual) {
                        throw new Error(`Expected ${actual} to be truthy`);
                    }
                },
                toBeFalsy: function() {
                    if (actual) {
                        throw new Error(`Expected ${actual} to be falsy`);
                    }
                }
            };
        }

        // Test file loader
        async function loadTestFile(filename) {
            updateFileStatus(filename, 'loading');
            
            try {
                const response = await fetch(`test-files/${filename}`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                const code = await response.text();
                
                // Execute the test file code
                eval(code);
                
                updateFileStatus(filename, 'loaded');
                return true;
            } catch (error) {
                console.error(`Error loading ${filename}:`, error);
                updateFileStatus(filename, 'error', error.message);
                return false;
            }
        }

        function updateFileStatus(filename, status, error = null) {
            const existingFile = loadedFiles.find(f => f.name === filename);
            if (existingFile) {
                existingFile.status = status;
                existingFile.error = error;
            } else {
                loadedFiles.push({ name: filename, status, error });
            }
            
            displayFileStatus();
        }

        function displayFileStatus() {
            const statusDiv = document.getElementById('file-status');
            statusDiv.innerHTML = loadedFiles.map(file => {
                const icon = file.status === 'loaded' ? '‚úÖ' : 
                           file.status === 'error' ? '‚ùå' : '‚è≥';
                const errorText = file.error ? ` - ${file.error}` : '';
                
                return `<div class="file-item ${file.status}">
                    <span class="file-icon">${icon}</span>
                    <span>${file.name}${errorText}</span>
                </div>`;
            }).join('');
        }

        function updateStats() {
            document.getElementById('stat-passed').textContent = passedTests;
            document.getElementById('stat-failed').textContent = failedTests;
            document.getElementById('stat-total').textContent = totalTests;
            document.getElementById('stat-files').textContent = loadedFiles.filter(f => f.status === 'loaded').length;
        }

        // Load all test files and run tests
        async function runAllTests() {
            const testFiles = TEST_CONFIG.testFiles;
            
            // Initialize file status
            testFiles.forEach(filename => {
                loadedFiles.push({ name: filename, status: 'loading', error: null });
            });
            displayFileStatus();
            
            // Load all test files
            for (const filename of testFiles) {
                await loadTestFile(filename);
            }
            
            // Run tests after all files are loaded
            setTimeout(() => {
                displayResults();
                updateStats();
            }, 100);
        }

        function displayResults() {
            const resultsDiv = document.getElementById('test-results');
            
            if (testSuites.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="test-suite">
                        <div class="test-suite-header">
                            <h2>‚ùå No tests found</h2>
                        </div>
                        <div class="test-suite-body">
                            <div class="test-case">
                                <span class="test-name">Make sure your test files are in the test-files/ directory and properly configured in test-config.js</span>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }
            
            resultsDiv.innerHTML = '';
            
            testSuites.forEach(suite => {
                const suiteDiv = document.createElement('div');
                suiteDiv.className = 'test-suite';
                
                const headerDiv = document.createElement('div');
                headerDiv.className = 'test-suite-header';
                headerDiv.innerHTML = `<h2>${suite.name}</h2>`;
                
                const bodyDiv = document.createElement('div');
                bodyDiv.className = 'test-suite-body';
                
                suite.tests.forEach(test => {
                    const testDiv = document.createElement('div');
                    testDiv.className = `test-case ${test.status}`;
                    
                    const icon = test.status === 'pass' ? '‚úÖ' : '‚ùå';
                    testDiv.innerHTML = `
                        <span class="test-icon">${icon}</span>
                        <div class="test-name">
                            ${test.name}
                            ${test.error ? `<div class="test-error">${test.error}</div>` : ''}
                        </div>
                    `;
                    
                    bodyDiv.appendChild(testDiv);
                });
                
                suiteDiv.appendChild(headerDiv);
                suiteDiv.appendChild(bodyDiv);
                resultsDiv.appendChild(suiteDiv);
            });
        }

        // Start loading tests when page loads
        window.onload = function() {
            if (TEST_CONFIG.settings.autoRun) {
                runAllTests();
            }
        };
    </script>
</body>
</html>